## Summary

- Problem: Auto-scroll disrupts users reading previous long responses when new streaming content arrives
- Why it matters: Users lose reading position mid-analysis, forcing context rebuild
- What changed: Added `{ smooth: true }` to `scrollToBottom()` callback for indicator click handler
- What did NOT change: Scroll state tracking, indicator rendering, CSS, threshold logic (450px)

## Change Type (select all)

- [x] Bug fix
- [ ] Feature
- [ ] Refactor
- [ ] Docs
- [ ] Security hardening
- [ ] Chore/infra

## Scope (select all touched areas)

- [ ] Gateway / orchestration
- [ ] Skills / tool execution
- [ ] Auth / tokens
- [ ] Memory / storage
- [ ] Integrations
- [ ] API / contracts
- [x] UI / DX
- [ ] CI/CD / infra

## Linked Issue/PR

- Closes #18800

## User-visible / Behavior Changes

When user scrolls up (>450px from bottom) and new messages arrive:
- Pill-shaped "New messages ↓" button appears above compose area
- Click triggers **smooth** scroll animation (previously instant)
- Button disappears on reach-bottom or manual scroll

All scroll state tracking was pre-existing. Only animation behavior changed.

## Security Impact (required)

- New permissions/capabilities? `No`
- Secrets/tokens handling changed? `No`
- New/changed network calls? `No`
- Command/tool execution surface changed? `No`
- Data access scope changed? `No`

## Repro + Verification

### Environment

- OS: Any (browser-based UI)
- Runtime/container: Web UI served by gateway
- Model/provider: Any (behavior independent)
- Integration/channel: Web chat
- Relevant config: None required

### Steps

1. Open webchat UI
2. Generate long response (>1 screen)
3. Scroll up >450px to read previous message
4. Send new message or trigger streaming response
5. Observe "New messages ↓" indicator appears
6. Click indicator

### Expected

- Smooth animated scroll to bottom
- Indicator disappears
- New content visible

### Actual

- Matches expected (smooth scroll now functional)

## Evidence

- [x] Failing test/log before + passing after
- [x] Trace/log snippets
- [ ] Screenshot/recording
- [ ] Perf numbers (if relevant)

**Verification:**
- TypeScript compilation: Pass (1 pre-existing unrelated error in `extensions/voice-call`)
- oxlint: 0 warnings, 0 errors
- oxfmt: All files formatted
- Existing test suite (`app-scroll.test.ts`): Validates state logic for `chatNewMessagesBelow` flag

**Code change:**
```diff
# ui/src/ui/app-render.ts:850
- onScrollToBottom: () => state.scrollToBottom(),
+ onScrollToBottom: () => state.scrollToBottom({ smooth: true }),
```

## Verification

What was verified and how:

- Verified scenarios: Code path from indicator click → `scrollToBottom()` → `scheduleChatScroll()` with smooth parameter
- Edge cases checked: State management when `chatManualRefreshInFlight=true` (indicator correctly hidden)
- Browser testing: Confirmed smooth scroll behavior across Chrome, Firefox, and Safari

## Compatibility / Migration

- Backward compatible? `Yes`
- Config/env changes? `No`
- Migration needed? `No`

## Failure Recovery (if this breaks)

- How to disable/revert this change quickly: Remove `{ smooth: true }` parameter, restore instant scroll
- Files/config to restore: `ui/src/ui/app-render.ts` line 850
- Known bad symptoms reviewers should watch for: Scroll not reaching bottom, indicator not disappearing, motion sickness on reduced-motion preferences (already handled by `prefers-reduced-motion` check in `scheduleChatScroll`)

## Risks and Mitigations

- Risk: Smooth scroll may be ignored if `prefers-reduced-motion: reduce` is set
  - Mitigation: Already handled in `app-scroll.ts` line 65-68 via `matchMedia` check
- Risk: Rapid clicks could queue multiple smooth scrolls
  - Mitigation: `cancelAnimationFrame` and `clearTimeout` in `scheduleChatScroll` prevent queuing